<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hayatta Kalma Ãœs YÃ¶netimi - Mobil</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-dark: #15181e;
            --bg-panel: rgba(255,255,255,0.04);
            --border: 1px solid rgba(255,255,255,0.1);
            --text: #d5d8dc;
            --accent: #5dade2;
            --danger: #c0392b;
            --nav-h: 58px;
            --stats-h: 72px;
            --bg-war: url('images/OYUN SAVAÅž ARKA PLANI.png');
            --bg-base: url('images/OYUN SAVAÅž ARKA PLANI.png');
            --hitScale: 1;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Helvetica, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            cursor: crosshair;
        }

        /* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .game-container {
            display: flex;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        /* Top stats bar */
        .stats-bar {
            flex: 0 0 var(--stats-h);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 6px;
            padding: 8px 10px;
            background: rgba(0,0,0,0.55);
            border-bottom: var(--border);
            z-index: 100;
        }

        .stat-chip {
            background: var(--bg-panel);
            border: var(--border);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4px 2px;
            gap: 1px;
        }

        .stat-chip .label {
            font-size: 9px;
            font-weight: 700;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            color: var(--accent);
            opacity: 0.8;
        }

        .stat-chip .value {
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
        }

        .stat-chip.danger .value { color: var(--danger); }

        /* Middle scene area */
        .scene-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            min-height: 0;
        }

        /* Screens inside scene-area */
        .screen {
            display: none;
            position: absolute;
            inset: 0;
            flex-direction: column;
        }

        .screen.active {
            display: flex;
        }

        /* â”€â”€ BOTTOM NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .bottom-tabs {
            flex: 0 0 var(--nav-h);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            background: rgba(0,0,0,0.7);
            border-top: var(--border);
            z-index: 1200;
            gap: 6px;
            padding: 6px;
        }

        .tab-btn {
            background: var(--bg-panel);
            border: var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: inherit;
            font-weight: 700;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            cursor: pointer;
            user-select: none;
            transition: border-color 0.15s, color 0.15s;
        }

        .tab-btn.active {
            border-color: var(--accent);
            color: var(--accent);
        }

        .tab-sub {
            font-size: 10px;
            font-weight: 400;
            opacity: 0.6;
        }

        /* â”€â”€ WAR SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #screen-war {
            background: rgba(10,12,16,0.85);
            background-image: var(--bg-war);
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            align-items: center;
            justify-content: center;
        }

        .action-area {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .timer {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 16px;
            font-weight: 700;
            color: var(--accent);
            background: rgba(0,0,0,0.65);
            padding: 6px 12px;
            border-radius: 6px;
            border: var(--border);
            letter-spacing: 1px;
            z-index: 10;
        }

        .character-container {
            position: relative;
            width: 160px;
            height: 240px;
        }

        .side-characters {
            position: absolute;
            left: -140px;
            top: -140px;
            width: calc(100% + 280px);
            height: calc(100% + 280px);
            pointer-events: none;
            z-index: 2;
        }

        .side-characters .base-character {
            width: 130px;
            height: 130px;
            position: absolute;
            pointer-events: none;
            transform: translate(-50%, -50%);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border: none;
            box-shadow: none;
            background-color: transparent;
            opacity: 0.88;
        }
        .side-characters .base-character.isci      { background-image: url('images/iÅŸci.png'); }
        .side-characters .base-character.muhafiz   { background-image: url('images/muhafÄ±z.png'); }
        .side-characters .base-character.sihhiyeci { background-image: url('images/doktor (1).png'); }
        .side-characters .base-character.isyanci   { background-image: url('images/isyancÄ±.png'); }

        .character {
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            transition: all 0.25s ease;
            position: relative;
            z-index: 3;
        }

        .character.normal    { background-image: url('images/isyancÄ±.png'); }
        .character.head-shot  { background-image: url('images/kafasÄ±ndan vurulan isyancÄ±.png'); }
        .character.chest-shot { background-image: url('images/gÃ¶ÄŸsÃ¼nden vurulan dÃ¼ÅŸman.png'); }
        .character.leg-shot   { background-image: url('images/ayaktan vurulan dÃ¼ÅŸman.png'); }

        .hit-zone { position: absolute; cursor: pointer; z-index: 6; pointer-events: auto; }
        .hit-zone:hover { background: rgba(255,255,255,0.08); border-radius: 50%; }
        .head-zone  { width: calc(40px * var(--hitScale,1)); height: calc(40px * var(--hitScale,1)); top: 10%; left: 50%; transform: translateX(-50%); }
        .chest-zone { width: calc(50px * var(--hitScale,1)); height: calc(50px * var(--hitScale,1)); top: 40%; left: 50%; transform: translateX(-50%); }
        .leg-zone   { width: calc(45px * var(--hitScale,1)); height: calc(45px * var(--hitScale,1)); bottom: 10%; left: 50%; transform: translateX(-50%); }

        /* â”€â”€ BASE SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #screen-base { overflow-y: auto; }

        #base-stage {
            flex: 1;
            min-height: 220px;
            position: relative;
            overflow: hidden;
            border-bottom: 5px solid rgba(44,62,80,0.9);
        }

        /* Katman 1: Zemin */
        .stage-ground {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: var(--bg-base);
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #15181e;
            z-index: 1;
        }

        /* Katman 2: Karakterler */
        .stage-characters {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        /* Karakter temel stili */
        .walker {
            position: absolute;
            width: 28px;
            height: 42px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom center;
        }
        .walker.isci      { background-image: url('images/iÅŸci.png'); }
        .walker.muhafiz   { background-image: url('images/muhafÄ±z.png'); }
        .walker.sihhiyeci { background-image: url('images/doktor (1).png'); }
        .walker.isyanci   { background-image: url('images/isyancÄ±.png'); }

        /* Oyuncu karakteri */
        .player-character {
            position: absolute;
            width: 48px;
            height: 48px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 10;
            transition: left 0.2s ease, top 0.2s ease;
            border: 2px solid red; /* DEBUG - GÃ¶rÃ¼nÃ¼r olup olmadÄ±ÄŸÄ±nÄ± test et */
        }
        .player-character.up    { background-image: url('images/sag.png'); }
        .player-character.down  { background-image: url('images/sag.png'); }
        .player-character.left  { background-image: url('images/sol.png'); }
        .player-character.right { background-image: url('images/sag.png'); }

        
        .base-info-bar {
            flex: 0 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            padding: 8px 10px;
            background: rgba(0,0,0,0.55);
        }

        .base-chip {
            background: var(--bg-panel);
            border: var(--border);
            border-radius: 6px;
            padding: 5px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .base-chip .blabel { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; color: var(--accent); }
        .base-chip .bval   { font-size: 13px; font-weight: 700; color: var(--text); }

        .raid-bar {
            flex: 0 0 auto;
            background: rgba(192,57,43,0.12);
            border-top: 1px solid rgba(192,57,43,0.35);
            padding: 6px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: var(--danger);
            animation: pulse 2s infinite;
        }

        /* â”€â”€ BASKIN RAPORU MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #raid-report {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.82);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .raid-report-box {
            background: #1a1e26;
            border: 1px solid var(--danger);
            border-radius: 10px;
            padding: 20px 24px;
            width: min(340px, 90vw);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .raid-report-title {
            font-size: 16px;
            font-weight: 900;
            letter-spacing: 2px;
            text-align: center;
            color: var(--danger);
            text-transform: uppercase;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(192,57,43,0.3);
        }
        .raid-report-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--text);
        }
        .raid-report-section {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--accent);
            margin-top: 4px;
        }
        .raid-report-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        .raid-report-btn {
            margin-top: 8px;
            background: var(--danger);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 1px;
            padding: 10px;
            cursor: pointer;
            text-transform: uppercase;
        }
        .raid-report-btn:hover { opacity: 0.85; }

        .hp-strip {
            flex: 0 0 5px;
            background: rgba(0,0,0,0.4);
        }
        .hp-strip-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), #e74c3c);
            transition: width 0.3s;
        }

        /* â”€â”€ SETTINGS SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #screen-settings {
            overflow-y: auto;
            padding: 12px;
            gap: 10px;
        }

        .settings-group {
            background: var(--bg-panel);
            border: var(--border);
            border-radius: 8px;
            padding: 10px 12px;
        }

        .settings-title {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .settings-row {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 10px;
            padding: 7px 0;
            border-top: 1px solid rgba(255,255,255,0.06);
        }
        .settings-row:first-of-type { border-top: none; }

        .settings-label { font-size: 13px; color: var(--text); }
        .settings-hint  { font-size: 10px; opacity: 0.5; margin-top: 2px; }

        .settings-control { display: flex; align-items: center; gap: 8px; }

        .toggle {
            width: 48px; height: 26px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(0,0,0,0.4);
            position: relative; cursor: pointer;
        }
        .toggle::after {
            content: '';
            position: absolute;
            top: 50%; left: 3px;
            width: 18px; height: 18px;
            border-radius: 50%;
            transform: translateY(-50%);
            background: rgba(200,200,200,0.8);
            transition: left 0.15s;
        }
        .toggle.on { border-color: var(--accent); }
        .toggle.on::after { left: 26px; background: var(--accent); }

        input[type="range"] { width: 140px; accent-color: var(--accent); }

        .control-button {
            background: var(--bg-panel);
            border: var(--border);
            color: var(--text);
            font-family: inherit;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            margin: 3px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .control-button:hover { border-color: var(--accent); color: var(--accent); }

        /* â”€â”€ SHARED UTILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @keyframes pulse { 0%,100%{opacity:.7} 50%{opacity:1} }

        .crosshair {
            position: fixed;
            width: 40px; height: 40px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><circle cx="20" cy="20" r="15" fill="none" stroke="white" stroke-width="2"/><line x1="20" y1="5" x2="20" y2="35" stroke="white" stroke-width="2"/><line x1="5" y1="20" x2="35" y2="20" stroke="white" stroke-width="2"/></svg>') no-repeat center;
            background-size: contain;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
        }

        .hit-effect {
            position: fixed;
            width: 50px; height: 50px;
            border: 3px solid #f39c12;
            border-radius: 50%;
            pointer-events: none;
            animation: hit-burst 0.5s ease-out forwards;
            transform: translate(-50%, -50%);
            z-index: 9998;
        }
        @keyframes hit-burst {
            0%   { transform: translate(-50%,-50%) scale(0.3); opacity: 1; }
            100% { transform: translate(-50%,-50%) scale(1.8); opacity: 0; }
        }

        .hp-bar { width: 100%; height: 6px; background: rgba(0,0,0,0.4); overflow: hidden; }
        .hp-fill { height: 100%; background: linear-gradient(90deg, var(--danger), #e74c3c); transition: width 0.3s; }

        .game-over {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.92);
            display: flex; align-items: center; justify-content: center;
            z-index: 9999;
        }
        .game-over-content {
            background: rgba(21,24,30,0.98);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 12px;
            padding: 28px 32px;
            text-align: center;
            max-width: 280px;
        }
        .game-over-title { font-size: 22px; font-weight: 700; color: var(--accent); margin-bottom: 8px; letter-spacing: 2px; }
        .game-over-text  { font-size: 14px; color: var(--text); margin-bottom: 18px; opacity: 0.8; }
        .restart-btn {
            background: var(--accent);
            border: none; color: #fff;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 13px; font-weight: 700;
            cursor: pointer; letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <div class="crosshair" id="crosshair"></div>

    <div class="game-container">

        <!-- â”€â”€ ÃœST Ä°STATÄ°STÄ°K BARI â”€â”€ -->
        <div class="stats-bar">
            <div class="stat-chip">
                <span class="label">CAN</span>
                <span class="value" id="hp">100</span>
            </div>
            <div class="stat-chip">
                <span class="label">NÃœFUS</span>
                <span class="value" id="population">0/50</span>
            </div>
            <div class="stat-chip">
                <span class="label">GIDA</span>
                <span class="value" id="food">100</span>
            </div>
            <div class="stat-chip">
                <span class="label">GÃœN</span>
                <span class="value" id="day">1</span>
            </div>
        </div>

        <!-- â”€â”€ ORTA SAHNE ALANI â”€â”€ -->
        <div class="scene-area">

            <!-- SAVAÅž EKRANÄ± -->
            <div class="screen active" id="screen-war">
                <div class="action-area" id="action-area">
                    <div class="timer" id="timer">SÃ¼re: 5.0</div>
                    <div class="character-container">
                        <div class="side-characters" id="side-characters"></div>
                        <div class="character normal" id="target-character"></div>
                        <div class="hit-zone head-zone"  data-target="head"  title="BAÅž"></div>
                        <div class="hit-zone chest-zone" data-target="chest" title="GÃ–ÄžÃœS"></div>
                        <div class="hit-zone leg-zone"   data-target="leg"   title="BACAK"></div>
                    </div>
                </div>
            </div>

            <!-- ANA ÃœS EKRANÄ± -->
            <div class="screen" id="screen-base">
                <!-- Animasyonlu sahne -->
                <div id="base-stage">
                    <div class="stage-ground"></div>
                    <div class="stage-characters" id="stage-characters">
                        <div id="player-character" class="player-character"></div>
                    </div>
                    <div class="stage-overlay" style="pointer-events:none;"></div>
                </div>

                <!-- HP ÅŸeridi -->
                <div class="hp-strip">
                    <div class="hp-strip-fill" id="base_hp_bar" style="width:100%"></div>
                </div>

                <!-- NÃ¼fus bilgi Ã§ipleri -->
                <div class="base-info-bar">
                    <div class="base-chip"><span class="blabel">MuhafÄ±z</span><span class="bval" id="base_guards">-</span></div>
                    <div class="base-chip"><span class="blabel">SÄ±hhiyeci</span><span class="bval" id="base_healers">-</span></div>
                    <div class="base-chip"><span class="blabel">Ä°ÅŸÃ§i</span><span class="bval" id="base_workers">-</span></div>
                    <div class="base-chip"><span class="blabel">Ä°syancÄ±</span><span class="bval" id="base_rebels">-</span></div>
                    <div class="base-chip"><span class="blabel">GÄ±da</span><span class="bval" id="base_food">-</span></div>
                    <div class="base-chip"><span class="blabel">Ä°laÃ§</span><span class="bval" id="base_medicine">-</span></div>
                </div>

                <!-- BaskÄ±n uyarÄ± barÄ± -->
                <div class="raid-bar">
                    <span>âš  BASKIN</span>
                    <span id="base_raid_timer">-</span>
                    <span id="base_raid_size">-</span>
                </div>
            </div>

            <!-- AYARLAR EKRANÄ± -->
            <div class="screen" id="screen-settings">
                <div class="settings-group">
                    <div class="settings-title">Oyun AyarlarÄ±</div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-label">TitreÅŸim</div>
                            <div class="settings-hint">VuruÅŸta kÄ±sa titreÅŸim</div>
                        </div>
                        <div class="settings-control">
                            <div id="set_vibration" class="toggle on" role="switch" aria-checked="true"></div>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-label">NiÅŸangah Hassasiyeti</div>
                            <div class="settings-hint">Dokunmatik iÃ§in hedef boyutu</div>
                        </div>
                        <div class="settings-control">
                            <input id="set_sensitivity" type="range" min="50" max="200" value="100">
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-label">Pil Modu</div>
                            <div class="settings-hint">AnimasyonlarÄ± azaltÄ±r</div>
                        </div>
                        <div class="settings-control">
                            <div id="set_battery" class="toggle" role="switch" aria-checked="false"></div>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <div class="settings-title">Oyun KontrolÃ¼</div>
                    <div style="display:flex; gap:8px; padding-top:6px;">
                        <button class="control-button" style="flex:1" onclick="game.duraklat()">Durdur / Devam</button>
                        <button class="control-button" style="flex:1" onclick="game.restart()">Yeniden BaÅŸlat</button>
                    </div>
                </div>

                <div class="settings-group">
                    <div class="settings-title">Bilgi</div>
                    <div class="settings-row">
                        <div class="settings-label">Saat</div>
                        <div style="font-size:13px; color:var(--accent)" id="ui_clock">--:--</div>
                    </div>
                </div>
            </div>

        </div><!-- /scene-area -->

        <!-- â”€â”€ ALT NAVÄ°GASYON â”€â”€ -->
        <div class="bottom-tabs" role="tablist">
            <button class="tab-btn" id="tab-base" data-screen="base" aria-selected="false">
                <span>ANA ÃœS</span>
                <span class="tab-sub">YÃ¶netim</span>
            </button>
            <button class="tab-btn active" id="tab-war" data-screen="war" aria-selected="true">
                <span>SAVAÅž</span>
                <span class="tab-sub">NiÅŸangah</span>
            </button>
            <button class="tab-btn" id="tab-settings" data-screen="settings" aria-selected="false">
                <span>AYARLAR</span>
                <span class="tab-sub" id="tab-clock">--:--</span>
            </button>
        </div>

    </div><!-- /game-container -->

    <script>
        class HayattaKalmaOyunu {
            constructor() {
                this.oyuncuHp = 100;
                this.mevcutGun = 1;
                this.baskinaKalanGun = 20;
                this.sonrakiBaskinBuyuklugu = 70;
                this.usNufusu = [];
                this.nufusLimiti = 50;
                this.kaynaklar = { gida: 100, ilac: 50, malzeme: 75 };
                this.oyunBitti = false;
                this.duraklatildi = false;
                this.kalanSure = 5.0;
                this.timerInterval = null;

                this.yanKarakterler = [];

                this.ayarlar = {
                    ses: 80,
                    titresim: true,
                    hassasiyet: 100,
                    pilModu: false
                };

                // Oyuncu karakteri
                this.oyuncuKarakter = {
                    x: 50,
                    y: 50,
                    yon: 'down',
                    hiz: 2
                };
                
                this.init();
            }

            init() {
                // BaÅŸlangÄ±Ã§ nÃ¼fusu
                this.karakterEkle('isci', 'sadik');
                this.karakterEkle('muhafiz', 'sadik');
                this.karakterEkle('sihhiyeci', 'sadik');

                this.yeniKarsilasmaOlustur();
                
                this.arayuzuGuncelle();
                this.aksiyonTimerBaslat(true);
                this.karakterleriAnimasyonla();
                this.nisangahKurulumu();
                this.oyuncuKarakteriBaslat();
            }

            yeniKarsilasmaOlustur() {
                // DÃ¼ÅŸmanla birlikte ortaya Ã§Ä±kan rastgele yan karakterler
                const olasiTipler = ['isci', 'muhafiz', 'sihhiyeci'];
                const adet = Math.floor(Math.random() * 4); // 0-3
                this.yanKarakterler = [];
                for (let i = 0; i < adet; i++) {
                    const tip = olasiTipler[Math.floor(Math.random() * olasiTipler.length)];
                    const kisilik = tip === 'muhafiz' ? 'sadik' : this.rastgeleKisilik();
                    this.yanKarakterler.push({ tip, kisilik });
                }
                this.yanKarakterleriCiz();
            }

            yanKarakterleriCiz() {
                const alan = document.getElementById('side-characters');
                if (!alan) return;
                alan.innerHTML = '';

                const w = alan.clientWidth || 180;
                const h = alan.clientHeight || 250;

                // DÃ¼ÅŸmanÄ±n etrafÄ±ndaki sabit slotlar (yÃ¼zde olarak)
                const slots = [
                    { x: 25, y: 40 },
                    { x: 75, y: 40 },
                    { x: 20, y: 72 },
                    { x: 80, y: 72 },
                    { x: 50, y: 82 }
                ];

                this.yanKarakterler.forEach((k, i) => {
                    const el = document.createElement('div');
                    el.className = `base-character ${k.tip}`;

                    const slot = slots[i % slots.length];
                    const x = (slot.x / 100) * w;
                    const y = (slot.y / 100) * h;
                    el.style.left = `${x}px`;
                    el.style.top = `${y}px`;

                    alan.appendChild(el);
                });
            }

            nisangahKurulumu() {
                // NiÅŸangah takibi
                document.addEventListener('mousemove', (e) => {
                    if (window.uiDurum?.aktifEkran !== 'war') return;
                    const crosshair = document.getElementById('crosshair');
                    crosshair.style.left = e.clientX + 'px';
                    crosshair.style.top = e.clientY + 'px';
                });

                // Gizli hedef bÃ¶lgelerine tÄ±klama
                document.querySelectorAll('.hit-zone').forEach(zone => {
                    zone.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const hedef = zone.dataset.target;
                        const rect = zone.getBoundingClientRect();
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;
                        this.vur(hedef, centerX, centerY);
                    });
                });

                // Karakterin kendisine tÄ±klama (iskalama)
                document.getElementById('target-character').addEventListener('click', (e) => {
                    if (e.target.id === 'target-character') {
                        this.vur('missed', e.clientX, e.clientY);
                    }
                });
            }

            karakterEkle(tip, kisilik) {
                if (this.usNufusu.length < this.nufusLimiti) {
                    this.usNufusu.push({
                        id: Date.now(),
                        tip: tip,
                        kisilik: kisilik,
                        saglik: 100,
                        yarali: false,
                        usdeGunu: 0
                    });
                }
            }

            vur(hedef, x, y) {
                if (this.oyunBitti || this.duraklatildi) return;
                
                this.aksiyonTimerDurdur();
                this.vurusEfektiGoster(x, y);
                this.karakterGorseliniGuncelle(hedef);
                
                let sonuc = this.aksiyonIsle(hedef);
                this.geriBildirimGoster(hedef, sonuc);

                // Her vuruÅŸta gÃ¼n ilerler (baskÄ±n sayacÄ± her karÅŸÄ±laÅŸmada azalÄ±r)
                // BaÅŸ/gÃ¶ÄŸÃ¼s vuruÅŸunda ihanet/baskÄ±n olaylarÄ± tetiklenmez (savaÅŸ anÄ±)
                const olaylariCalistir = !(hedef === 'head' || hedef === 'chest');
                this.gunuIlerle(olaylariCalistir);

                // DÃ¼ÅŸman gerÃ§ekten etkisiz mi?
                // missed veya baÅŸarÄ±sÄ±z bacak = dÃ¼ÅŸman hayatta, yeni karÅŸÄ±laÅŸma kur ama Ã¼sse kimse gitmiyor
                const dusmanOldu = sonuc.basarili && (hedef === 'head' || hedef === 'chest' || hedef === 'leg');

                if (dusmanOldu) {
                    this.yanKarakterler.forEach(k => this.karakterEkle(k.tip, k.kisilik));
                    const alan = document.getElementById('side-characters');
                    if (alan) alan.innerHTML = '';
                }

                this.arayuzuGuncelle();

                setTimeout(() => {
                    this.karakteriNormaleDondur();
                    // Her durumda yeni karÅŸÄ±laÅŸma kur (Ä±skalama dahil â€” dÃ¼ÅŸman kaÃ§tÄ±, yeni biri geldi)
                    this.yeniKarsilasmaOlustur();
                    this.aksiyonTimerBaslat(true);
                }, 1000);
            }

            karakterGorseliniGuncelle(hedef) {
                const character = document.getElementById('target-character');
                character.className = 'character';
                
                switch(hedef) {
                    case 'head':
                        character.classList.add('head-shot');
                        break;
                    case 'chest':
                        character.classList.add('chest-shot');
                        break;
                    case 'leg':
                        character.classList.add('leg-shot');
                        break;
                }
            }

            karakteriNormaleDondur() {
                const character = document.getElementById('target-character');
                character.className = 'character normal';
            }

            vurusEfektiGoster(x, y) {
                if (this.ayarlar.titresim && typeof navigator !== 'undefined' && typeof navigator.vibrate === 'function') {
                    navigator.vibrate(20);
                }
                const etki = document.createElement('div');
                etki.className = 'hit-effect';
                etki.style.left = x + 'px';
                etki.style.top = y + 'px';
                document.body.appendChild(etki);
                
                setTimeout(() => {
                    etki.remove();
                }, 600);
            }

            aksiyonIsle(hedef) {
                let sonuc = { basarili: false, nufusDegisimi: 0, alinanHasar: 0 };
                
                switch(hedef) {
                    case 'head':
                        // Kafadan vurunca Ã¶ldÃ¼rÃ¼r, can azalmaz
                        sonuc.basarili = true;
                        sonuc.nufusDegisimi = 1;
                        this.karakterEkle('isci', 'sadik');
                        break;
                    case 'chest':
                        // GÃ¶ÄŸÃ¼sten vurunca ikisi de kurtulur, can azalmaz
                        sonuc.basarili = true;
                        sonuc.nufusDegisimi = 2;
                        this.karakterEkle('isci', 'sadik');
                        this.karakterEkle('isyanci', this.rastgeleKisilik());
                        this.usNufusu[this.usNufusu.length - 1].yarali = true;
                        break;
                    case 'leg':
                        // Bacaktan vurunca 50% ihtimal karÅŸÄ± saldÄ±rÄ±
                        if (Math.random() < 0.5) {
                            sonuc.basarili = true;
                            sonuc.nufusDegisimi = 1;
                            this.karakterEkle('isci', 'guvensiz');
                        } else {
                            // Sadece bacakta karÅŸÄ± saldÄ±rÄ± olur
                            sonuc.alinanHasar = 15;
                            this.oyuncuHp -= 15;
                        }
                        break;
                    case 'missed':
                        sonuc.basarili = false;
                        break;
                }
                
                this.oyunBittiKontrol();
                return sonuc;
            }

            rastgeleKisilik() {
                const kisilikler = ['sadik', 'guvensiz', 'kurnaz'];
                return kisilikler[Math.floor(Math.random() * kisilikler.length)];
            }

            gunuIlerle(olaylariCalistir = true) {
                if (this.oyunBitti || this.duraklatildi) return;
                
                this.mevcutGun++;
                this.baskinaKalanGun--;
                
                // GÃ¼n ilerleme
                this.usNufusu.forEach(karakter => karakter.usdeGunu++);
                
                if (olaylariCalistir) {
                    // Ä°hanet kontrolÃ¼
                    this.ihanetKontrolu();
                }

                // BaskÄ±n kontrolÃ¼ her vuruÅŸta Ã§alÄ±ÅŸÄ±r (hit tipinden baÄŸÄ±msÄ±z)
                if (this.baskinaKalanGun <= 0) {
                    this.baskinaKalanGun = 0; // negatife dÃ¼ÅŸmesin
                    this.aksiyonTimerDurdur();
                    this.baskinTetikle();
                    this.baskinaKalanGun = 15 + Math.floor(Math.random() * 10);
                    this.sonrakiBaskinBuyuklugu = 60 + Math.floor(Math.random() * 30);
                }
                
                // Kaynak tÃ¼ketimi
                this.kaynaklariTuket();
            }

            ihanetKontrolu() {
                this.usNufusu = this.usNufusu.filter(karakter => {
                    if (karakter.tip === 'isyanci') {
                        const sans = this.ihanetSansiHesapla(karakter);
                        if (Math.random() < sans) {
                            this.ihanetIsle(karakter);
                            return false;
                        }
                    }
                    return true;
                });
            }

            ihanetSansiHesapla(karakter) {
                let sans = 0.1;
                switch(karakter.kisilik) {
                    case 'guvensiz': sans = 0.3; break;
                    case 'kurnaz': sans = 0.2; break;
                    case 'sadik': sans = 0.05; break;
                }
                if (karakter.yarali) sans += 0.1;
                if (karakter.usdeGunu > 7) sans += 0.1;
                return Math.min(sans, 0.5);
            }

            ihanetIsle(ihancÄ±) {
                const index = this.usNufusu.indexOf(ihancÄ±);
                if (index > -1) this.usNufusu.splice(index, 1);
                
                const etki = Math.floor(Math.random() * 3);
                switch(etki) {
                    case 0: this.oyuncuHp -= 20; break;
                    case 1: this.kaynaklar.gida -= 30; break;
                    case 2: 
                        if (this.usNufusu.length > 0) {
                            const kurbanIndex = Math.floor(Math.random() * this.usNufusu.length);
                            this.usNufusu.splice(kurbanIndex, 1);
                        }
                        break;
                }
            }

            baskinTetikle() {
                const dusmanGucu = this.sonrakiBaskinBuyuklugu; // Ã¶rn: 15

                // Bizim gÃ¼cÃ¼mÃ¼zÃ¼ hesapla
                let bizimGucumuz = 0;
                this.usNufusu.forEach(k => {
                    if (k.tip === 'muhafiz')   bizimGucumuz += 3;
                    else if (k.tip === 'isyanci') bizimGucumuz += 2;
                    else if (k.tip === 'isci')    bizimGucumuz += 1;
                    else if (k.tip === 'sihhiyeci') bizimGucumuz += 1;
                });

                // GÃ¼Ã§ farkÄ±na gÃ¶re kayÄ±p oranÄ±
                const gucFarki = dusmanGucu - bizimGucumuz;
                let olumOrani, yaraliOrani;

                if (gucFarki <= 0) {
                    // Biz kazandÄ±k
                    olumOrani   = 0.05;
                    yaraliOrani = 0.15;
                } else if (gucFarki <= 5) {
                    olumOrani   = 0.15;
                    yaraliOrani = 0.25;
                } else if (gucFarki <= 10) {
                    olumOrani   = 0.30;
                    yaraliOrani = 0.30;
                } else {
                    olumOrani   = 0.50;
                    yaraliOrani = 0.25;
                }

                // KayÄ±plarÄ± uygula
                const olduler = [];
                const yaralilar = [];
                const sagKalanlar = [];

                this.usNufusu.forEach(k => {
                    const r = Math.random();
                    if (r < olumOrani) {
                        olduler.push(k);
                    } else if (r < olumOrani + yaraliOrani) {
                        k.yarali = true;
                        yaralilar.push(k);
                        sagKalanlar.push(k);
                    } else {
                        sagKalanlar.push(k);
                    }
                });

                // Ã–lÃ¼leri Ã¼sten sil
                this.usNufusu = sagKalanlar;

                // Oyuncu HP'sine de etki
                if (gucFarki > 0) this.oyuncuHp -= Math.min(gucFarki * 3, 40);
                this.oyuncuHp = Math.max(0, this.oyuncuHp);

                // BaskÄ±n raporunu gÃ¶ster
                this.baskinRaporuGoster(dusmanGucu, bizimGucumuz, olduler, yaralilar);
            }

            baskinRaporuGoster(dusmanGucu, bizimGucumuz, olduler, yaralilar) {
                // Eski raporu kaldÄ±r
                const eskiRapor = document.getElementById('raid-report');
                if (eskiRapor) eskiRapor.remove();

                const kazandik = bizimGucumuz >= dusmanGucu;
                const tipAdi = { muhafiz: 'MuhafÄ±z', isci: 'Ä°ÅŸÃ§i', sihhiyeci: 'SÄ±hhiyeci', isyanci: 'Ä°syancÄ±' };

                const olduListesi = olduler.length === 0
                    ? '<span style="color:#4aff4a">KayÄ±p yok</span>'
                    : olduler.map(k => `<span style="color:#ff4a4a">âœ• ${tipAdi[k.tip] || k.tip}</span>`).join('');

                const yaraliListesi = yaralilar.length === 0
                    ? '<span style="color:#4aff4a">YaralÄ± yok</span>'
                    : yaralilar.map(k => `<span style="color:#f39c12">âš  ${tipAdi[k.tip] || k.tip}</span>`).join('');

                const rapor = document.createElement('div');
                rapor.id = 'raid-report';
                rapor.innerHTML = `
                    <div class="raid-report-box">
                        <div class="raid-report-title">${kazandik ? 'âš” BASKIN SAVUÅžTURULDU' : 'ðŸ’€ BASKIN BAÅžARISIZ'}</div>
                        <div class="raid-report-row">
                            <span>DÃ¼ÅŸman GÃ¼cÃ¼</span><span>${dusmanGucu}</span>
                        </div>
                        <div class="raid-report-row">
                            <span>Bizim GÃ¼cÃ¼mÃ¼z</span><span>${bizimGucumuz}</span>
                        </div>
                        <div class="raid-report-section">Ã–lÃ¼ler (${olduler.length})</div>
                        <div class="raid-report-list">${olduListesi}</div>
                        <div class="raid-report-section">YaralÄ±lar (${yaralilar.length})</div>
                        <div class="raid-report-list">${yaraliListesi}</div>
                        <button class="raid-report-btn" onclick="document.getElementById('raid-report').remove()">Tamam</button>
                    </div>
                `;
                document.body.appendChild(rapor);
            }

            kaynaklariTuket() {
                const nufusBuyuklugu = this.usNufusu.length;
                this.kaynaklar.gida -= nufusBuyuklugu;
                
                const yaraliSayisi = this.usNufusu.filter(karakter => karakter.yarali).length;
                this.kaynaklar.ilac -= yaraliSayisi * 2;
                
                this.kaynaklar.gida = Math.max(0, this.kaynaklar.gida);
                this.kaynaklar.ilac = Math.max(0, this.kaynaklar.ilac);
                this.kaynaklar.malzeme = Math.max(0, this.kaynaklar.malzeme);
            }

            oyunBittiKontrol() {
                if (this.oyuncuHp <= 0 || this.usNufusu.length === 0) {
                    this.oyunBitti = true;
                    this.oyunBittiGoster(false);
                } else if (this.mevcutGun >= 100) {
                    this.oyunBitti = true;
                    this.oyunBittiGoster(true);
                }
            }

            aksiyonTimerBaslat(yenidenBaslat = true) {
                // SavaÅŸ sekmesi dÄ±ÅŸÄ±nda sÃ¼re akmasÄ±n
                if (window.uiDurum?.aktifEkran && window.uiDurum.aktifEkran !== 'war') return;

                // Ã‡ift interval oluÅŸmasÄ±nÄ± engelle
                this.aksiyonTimerDurdur();

                // Her yeni kiÅŸi iÃ§in 5 saniye ver (resume'da sÄ±fÄ±rlama)
                if (yenidenBaslat) this.kalanSure = 5.0;
                let sureBitti = false;
                this.timerInterval = setInterval(() => {
                    if (!this.duraklatildi && !this.oyunBitti) {
                        if (window.uiDurum?.aktifEkran && window.uiDurum.aktifEkran !== 'war') return;
                        this.kalanSure = Math.max(0, this.kalanSure - 0.1);
                        document.getElementById('timer').textContent = `SÃ¼re: ${this.kalanSure.toFixed(1)}`;
                        
                        if (this.kalanSure <= 0 && !sureBitti) {
                            sureBitti = true;
                            this.aksiyonTimerDurdur();
                            this.vur('missed', window.innerWidth / 2, window.innerHeight / 2);
                        }
                    }
                }, 100);
            }

            aksiyonTimerDurdur() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }

            geriBildirimGoster(hedef, sonuc) {
                const timerElement = document.getElementById('timer');
                let geriBildirimMetni = '';
                
                switch(hedef) {
                    case 'head':
                        geriBildirimMetni = sonuc.basarili ? 'BAÅž VURUÅžU! (+1)' : 'Ä°SKALADIN!';
                        break;
                    case 'chest':
                        geriBildirimMetni = sonuc.basarili ? 'GÃ–ÄžÃœS VURUÅžU! (+2)' : 'Ä°SKALADIN!';
                        break;
                    case 'leg':
                        geriBildirimMetni = sonuc.basarili ? 'BACAK VURUÅžU! (+1)' : `KARÅžI SALDIRI! -${sonuc.alinanHasar} HP`;
                        break;
                    case 'missed':
                        geriBildirimMetni = 'HEDEF Ä°SKALANDI!';
                        break;
                }
                
                timerElement.textContent = geriBildirimMetni;
                timerElement.style.color = sonuc.basarili ? '#4aff4a' : '#ff4a4a';
                
                setTimeout(() => {
                    timerElement.style.color = 'var(--accent)';
                }, 2000);
            }

            arayuzuGuncelle() {
                const setText = (id, value) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = value;
                };
                const setWidth = (id, value) => {
                    const el = document.getElementById(id);
                    if (el) el.style.width = value;
                };

                const ist = this.nufusIstatistikleri();

                // Ãœst istatistik barÄ± (her zaman gÃ¶rÃ¼nÃ¼r)
                setText('hp', this.oyuncuHp);
                setText('population', `${ist.toplam}/${this.nufusLimiti}`);
                setText('food', this.kaynaklar.gida);
                setText('day', this.mevcutGun);

                // Ana Ãœs ekranÄ± bilgileri
                setText('base_guards',   ist.muhafizlar);
                setText('base_healers',  ist.sihhiyeciler);
                setText('base_workers',  ist.isciler);
                setText('base_rebels',   ist.isyancilar);
                setText('base_food',     this.kaynaklar.gida);
                setText('base_medicine', this.kaynaklar.ilac);
                setText('base_raid_timer', `${this.baskinaKalanGun} gÃ¼n`);
                setText('base_raid_size',  `${this.sonrakiBaskinBuyuklugu} isyancÄ±`);
                setWidth('base_hp_bar', `${Math.max(0, this.oyuncuHp)}%`);

                // Yan karakterleri savaÅŸ ekranÄ±nda Ã§iz
                this.yanKarakterleriCiz();
            }

            nufusIstatistikleri() {
                const istatistikler = { toplam: 0, muhafizlar: 0, sihhiyeciler: 0, isciler: 0, isyancilar: 0 };
                this.usNufusu.forEach(karakter => {
                    istatistikler.toplam++;
                    const tipMap = {
                        isci: 'isciler',
                        muhafiz: 'muhafizlar',
                        sihhiyeci: 'sihhiyeciler',
                        isyanci: 'isyancilar'
                    };
                    const anahtar = tipMap[karakter.tip];
                    if (anahtar && typeof istatistikler[anahtar] === 'number') {
                        istatistikler[anahtar]++;
                    }
                });
                return istatistikler;
            }

            karakterGorunumunuGuncelle() {
                // ArtÄ±k base-stage walker sistemi kullanÄ±yor, bu fonksiyon boÅŸ kalabilir
            }

            walkerEkle(tip, index = -1) {
                if (this.ayarlar.pilModu) return;
                const katman = document.getElementById('stage-characters');
                if (!katman) return;

                const walker = document.createElement('div');
                walker.className = `walker ${tip}`;

                // Pozisyon belirle
                let left, top;
                const w = katman.clientWidth || 360;
                const h = katman.clientHeight || 240;

                if (tip === 'isci') {
                    // Rastgele pozisyon
                    left = 10 + Math.random() * 80;
                    top = 10 + Math.random() * 80;
                } else if (tip === 'muhafiz') {
                    // Alt orta, yan yana sÄ±ra (boÅŸluk azaltÄ±ldÄ±)
                    const col = index % 6;
                    left = 20 + col * 6;
                    top = 75;
                } else if (tip === 'sihhiyeci') {
                    // Rastgele pozisyon
                    left = 10 + Math.random() * 80;
                    top = 10 + Math.random() * 80;
                } else {
                    // DiÄŸerleri rastgele (isyancÄ± vb.)
                    left = 10 + Math.random() * 80;
                    top = 10 + Math.random() * 80;
                }

                walker.style.left = `${left}%`;
                walker.style.top = `${top}%`;
                walker.style.transform = 'translate(-50%, -50%)';

                katman.appendChild(walker);
            }

            karakterleriAnimasyonla() {
                // Mevcut nÃ¼fusu sahneye yansÄ±t
                const katman = document.getElementById('stage-characters');
                if (!katman) return;
                katman.innerHTML = '';

                // Tiplere gÃ¶re indeks sayacÄ±
                const tipIndeksleri = { isci: 0, muhafiz: 0, sihhiyeci: 0, isyanci: 0 };

                this.usNufusu.forEach(k => {
                    const idx = tipIndeksleri[k.tip] || 0;
                    this.walkerEkle(k.tip, idx);
                    tipIndeksleri[k.tip] = idx + 1;
                });

                // NÃ¼fus deÄŸiÅŸimlerini periyodik olarak senkronize et
                setInterval(() => {
                    if (this.duraklatildi || this.oyunBitti || this.ayarlar.pilModu) return;
                    const katman = document.getElementById('stage-characters');
                    if (!katman) return;
                    const mevcutSayi = katman.querySelectorAll('.walker').length;
                    const hedefSayi = this.usNufusu.length;
                    if (mevcutSayi < hedefSayi) {
                        // Yeni eklenenleri doÄŸru indeksle ekle
                        const mevcutTipler = Array.from(katman.querySelectorAll('.walker')).map(w => w.className.split(' ')[1]);
                        const tipIndeksleri = { isci: 0, muhafiz: 0, sihhiyeci: 0, isyanci: 0 };
                        mevcutTipler.forEach(t => { if (t) tipIndeksleri[t]++; });
                        for (let i = mevcutSayi; i < hedefSayi; i++) {
                            const tip = this.usNufusu[i].tip;
                            const idx = tipIndeksleri[tip] || 0;
                            this.walkerEkle(tip, idx);
                            tipIndeksleri[tip] = idx + 1;
                        }
                    } else if (mevcutSayi > hedefSayi) {
                        const walkers = katman.querySelectorAll('.walker');
                        for (let i = hedefSayi; i < mevcutSayi; i++) {
                            walkers[i].remove();
                        }
                    }
                }, 2000);
            }

            oyuncuKarakteriBaslat() {
                const karakter = document.getElementById('player-character');
                if (!karakter) return;

                // BaÅŸlangÄ±Ã§ pozisyonu ve yÃ¶n
                this.oyuncuKarakteriGuncelle();
                this.oyuncuHareketiniBaslat();
            }

            oyuncuKarakteriGuncelle() {
                const karakter = document.getElementById('player-character');
                if (!karakter) return;

                karakter.style.left = `${this.oyuncuKarakter.x}%`;
                karakter.style.top = `${this.oyuncuKarakter.y}%`;
                karakter.style.transform = 'translate(-50%, -50%)';

                // YÃ¶ne gÃ¶re sÄ±nÄ±f deÄŸiÅŸtir
                karakter.className = `player-character ${this.oyuncuKarakter.yon}`;
            }

            oyuncuHareketiniBaslat() {
                // Rastgele hareket sistemi
                setInterval(() => {
                    if (this.oyunBitti || this.duraklatildi) return;
                    if (window.uiDurum?.aktifEkran !== 'base') return;

                    // Rastgele yÃ¶n seÃ§ (Ã§apraz yok)
                    const yonler = ['up', 'down', 'left', 'right'];
                    const yeniYon = yonler[Math.floor(Math.random() * yonler.length)];
                    this.oyuncuKarakter.yon = yeniYon;

                    // Hareket et
                    const adim = this.oyuncuKarakter.hiz;
                    switch (yeniYon) {
                        case 'up':
                            this.oyuncuKarakter.y = Math.max(5, this.oyuncuKarakter.y - adim);
                            break;
                        case 'down':
                            this.oyuncuKarakter.y = Math.min(95, this.oyuncuKarakter.y + adim);
                            break;
                        case 'left':
                            this.oyuncuKarakter.x = Math.max(5, this.oyuncuKarakter.x - adim);
                            break;
                        case 'right':
                            this.oyuncuKarakter.x = Math.min(95, this.oyuncuKarakter.x + adim);
                            break;
                    }

                    this.oyuncuKarakteriGuncelle();
                }, 800); // Her 800ms'de bir hareket
            }

            oyunBittiGoster(kazandi) {
                const oyunBittiDiv = document.createElement('div');
                oyunBittiDiv.className = 'game-over';
                oyunBittiDiv.innerHTML = `
                    <div class="game-over-content">
                        <div class="game-over-title">${kazandi ? 'ZAFER!' : 'OYUN BÄ°TTÄ°'}</div>
                        <div class="game-over-text">${kazandi ? '100 gÃ¼n hayatta kaldÄ±n!' : 'Hayatta kalamadÄ±n...'}</div>
                        <button class="restart-btn" onclick="game.restart()">Tekrar Oyna</button>
                    </div>
                `;
                document.body.appendChild(oyunBittiDiv);
            }

            duraklat() {
                this.duraklatildi = !this.duraklatildi;
                const button = document.querySelector('.control-button');
                if (button) {
                    button.textContent = this.duraklatildi ? 'Oyuna Devam Et' : 'Durdur/Devam';
                }
            }

            restart() {
                this.oyuncuHp = 100;
                this.mevcutGun = 1;
                this.baskinaKalanGun = 3;
                this.sonrakiBaskinBuyuklugu = 10;
                this.usNufusu = [];
                this.kaynaklar = { gida: 100, ilac: 50, malzeme: 75 };
                this.oyunBitti = false;
                this.duraklatildi = false;

                const oyunBittiDiv = document.querySelector('.game-over');
                if (oyunBittiDiv) oyunBittiDiv.remove();

                // Sadece walker'larÄ± temizle, katman yapÄ±sÄ±nÄ± koru
                const katman = document.getElementById('stage-characters');
                if (katman) katman.innerHTML = '';

                this.init();
            }
        }

        // Oyunu baÅŸlat
        const game = new HayattaKalmaOyunu();

        // Klavye kontrolleri
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    game.duraklat();
                    break;
                case 'r':
                case 'R':
                    game.restart();
                    break;
            }
        });

        // Touch kontrolleri
        document.addEventListener('touchstart', (e) => {
            if (window.uiDurum?.aktifEkran !== 'war') return;
            const touch = e.touches[0];
            const target = document.elementFromPoint(touch.clientX, touch.clientY);
            
            if (target && target.classList.contains('hit-zone')) {
                const hedef = target.dataset.target;
                game.vur(hedef, touch.clientX, touch.clientY);
            } else {
                game.vur('missed', touch.clientX, touch.clientY);
            }
        });

        window.uiDurum = { aktifEkran: 'war' };

        function ikiHane(n) {
            return String(n).padStart(2, '0');
        }

        function saatMetni() {
            const d = new Date();
            return `${ikiHane(d.getHours())}:${ikiHane(d.getMinutes())}`;
        }

        function ayarlarToggle(el) {
            const acik = el.classList.toggle('on');
            el.setAttribute('aria-checked', acik ? 'true' : 'false');
            return acik;
        }

        function anaUsEkraniniGuncelle() {
            if (typeof game === 'undefined') return;
            game.arayuzuGuncelle();
        }

        function ekranAyarla(hedef) {
            const onceki = window.uiDurum.aktifEkran;
            window.uiDurum.aktifEkran = hedef;

            ['war', 'base', 'settings'].forEach(k => {
                const scr = document.getElementById(`screen-${k}`);
                const tab = document.getElementById(`tab-${k}`);
                if (scr) scr.classList.toggle('active', k === hedef);
                if (tab) {
                    tab.classList.toggle('active', k === hedef);
                    tab.setAttribute('aria-selected', k === hedef ? 'true' : 'false');
                }
            });

            const crosshair = document.getElementById('crosshair');
            if (crosshair) crosshair.style.display = hedef === 'war' ? 'block' : 'none';

            if (hedef === 'base') anaUsEkraniniGuncelle();

            // Timer: savaÅŸ dÄ±ÅŸÄ±na Ã§Ä±kÄ±nca durdur, geri dÃ¶nÃ¼nce devam et
            if (onceki === 'war' && hedef !== 'war') game.aksiyonTimerDurdur();
            if (hedef === 'war' && onceki !== 'war') game.aksiyonTimerBaslat(false);
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const hedef = btn.dataset.screen;
                if (hedef) ekranAyarla(hedef);
            });
        });

        const vib = document.getElementById('set_vibration');
        if (vib) {
            vib.addEventListener('click', () => {
                game.ayarlar.titresim = ayarlarToggle(vib);
            });
        }

        const sens = document.getElementById('set_sensitivity');
        if (sens) {
            sens.addEventListener('input', () => {
                game.ayarlar.hassasiyet = parseInt(sens.value, 10);
                const scale = Math.max(0.8, Math.min(1.6, game.ayarlar.hassasiyet / 100));
                document.documentElement.style.setProperty('--hitScale', String(scale));
            });
        }

        const bat = document.getElementById('set_battery');
        if (bat) {
            bat.addEventListener('click', () => {
                game.ayarlar.pilModu = ayarlarToggle(bat);
            });
        }

        function saatGuncelle() {
            const t = saatMetni();
            const tabClock = document.getElementById('tab-clock');
            if (tabClock) tabClock.textContent = t;
            const uiClock = document.getElementById('ui_clock');
            if (uiClock) uiClock.textContent = t;
        }

        function cssVarAyarla(varAdi, urlDegeri) {
            document.documentElement.style.setProperty(varAdi, `url('${encodeURI(urlDegeri)}')`);
        }

        function arkaPlanYukleTercihli(varAdi, birincilYol, ikincilYol) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    cssVarAyarla(varAdi, birincilYol);
                    resolve(true);
                };
                img.onerror = () => {
                    cssVarAyarla(varAdi, ikincilYol);
                    resolve(false);
                };
                img.src = encodeURI(birincilYol);
            });
        }

        saatGuncelle();
        setInterval(saatGuncelle, 1000);

        // Sekme Ã§akÄ±ÅŸmasÄ±nÄ± engelle: baÅŸlangÄ±Ã§ta tek ekran
        ekranAyarla('war');

        // Arka planlarÄ± yerli yerine oturt (assets tercih, images fallback)
        arkaPlanYukleTercihli('--bg-base', 'images/Ã¼s arka planÄ± 2.png', 'images/Ã¼s arka planÄ± 2.png');
        arkaPlanYukleTercihli('--bg-war', 'assets/savas_arkaplani.png', 'images/OYUN SAVAÅž ARKA PLANI.png');

        // Ä°lk ayar uygulamalarÄ±
        if (sens) {
            const scale = Math.max(0.8, Math.min(1.6, parseInt(sens.value, 10) / 100));
            document.documentElement.style.setProperty('--hitScale', String(scale));
        }
    </script>
</body>
</html>
